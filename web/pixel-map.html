<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="Core Keeper Pixel Tools" />
        <meta name="author" content="randypanopio & RnDMonkey" />

        <title>Core Keeper Tools</title>

        <!-- icon -->
        <!-- <link rel="icon" type="img/favicon" href="img/favicon.png"> -->

        <!-- Bootstrap core CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
            crossorigin="anonymous"
        />

        <!-- Styling -->
        <link href="styles/css/main.css" rel="stylesheet" />
        <!-- Custom fonts -->
        <link
            href="https://fonts.googleapis.com/css?family=Open+Sans:300,600|Playfair+Display:400,900&display=swap"
            rel="stylesheet"
        />

        <!-- Additional Fonts, Icons, & Ligatures -->
        <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet" />
    </head>

    <body id="page-top">
        <div id="layout">
            <div id="left-pane">
                <!-- LEFT PANE CONTENT -->
                <div id="icon-size-container" class="d-flex align-items-center">
                    <span class="spaced">
                        <label for="icon-size-select" style="white-space: pre">Icon Sizes: </label>
                        <select id="icon-size-select" class="dark-text">
                            <option value="32">32 px</option>
                            <option value="48">48 px</option>
                            <!-- default selection -->
                            <option value="64" selected>64 px</option>
                        </select>
                    </span>
                    <span class="spaced">
                        <a href="data/core-keeper-palette.gpl">Click to download color palette for GIMP</a>
                    </span>
                    <span class="spaced">
                        <a href="contribute.html" class="btn btn-sm btn-info" target="_blank" rel="noopener noreferrer">
                            Contribute Item Images
                        </a>
                    </span>
                </div>
                <hr />
                <div id="item-selections-container">
                    <button type="submit" id="btn-toggle-colors">Toggle Item Selection</button>
                    Item Selections (click to disable specific items):
                    <div id="item-selections" class="d-flex flex-wrap"></div>
                    <hr />
                    <button type="submit" id="btn-toggle-counters">Toggle Item Counters</button>
                    Counter of items for this build (click to temporarily suppress items):

                    <div id="suppression-controls">
                        <span>Suppressed: <span id="suppression-count">0</span></span>
                        <button id="btn-clear-suppressed">Clear</button>
                    </div>

                    <div id="item-counters" class="d-flex flex-wrap">No Image Loaded yet!</div>
                </div>
            </div>
            <!-- end left pane -->

            <div id="drag-bar-left"></div>

            <div id="middle-pane">
                <!-- MIDDLE PANE CONTENT (Tile preview grid) -->
                <div class="d-flex justify-content-center align-items-center inputs">
                    <span>Tile Preview: Navigation (starts from the top left)</span>
                    <span>X: <input type="number" class="dark-text" value="1" id="chunk-input-x" min="1" /></span>
                    <span>Y: <input type="number" class="dark-text" value="1" id="chunk-input-y" min="1" /></span>
                    <button type="submit" id="btn-render-preview">Draw Grid Preview</button>
                    <br />
                </div>

                <div class="d-flex justify-content-center" id="preview-table-container">
                    <table id="preview-table">
                        <!-- Table to be inserted here by Table Creation script -->
                    </table>
                </div>
            </div>

            <div id="drag-bar-right"></div>

            <div id="right-pane">
                <!-- RIGHT PANE CONTENT (everything else) -->
                <div class="d-flex justify-content-center align-items-center">
                    Core Keeper Pixel Tone Map Tool / Pixel Preview Planner
                    <a href="about.html"><i style="margin-left: 12px; font-size: 28px" class="ri-question-fill"></i></a>
                </div>

                <div class="d-flex justify-content-center align-items-center inputs" id="inputs"></div>
                <label for="allow-larger-images" style="white-space: pre">Allow Huge Images </label
                ><input type="checkbox" id="allow-larger-images" checked />
                |
                <input type="file" id="image-upload" accept="image/png, image/jpeg" />
                <hr />
                <div class="d-flex justify-content-center align-items-center inputs" id="inputs">
                    <span>
                        Color Matching Method:
                        <select class="dark-text" id="process-options">
                            <option value="RGB">RGB (Fast)</option>
                            <option value="HSL">HSL Distance</option>
                            <option value="HSV">HSV Distance</option>
                            <option value="CAM16">CAM16-UCS</option>
                        </select>
                    </span>
                    |
                    <span id="cam16-weight-container" style="display: none"
                        >CAM16 J Factor:
                        <input
                            type="number"
                            class="dark-text"
                            value="1"
                            id="cam16-weight"
                            min="0.1"
                            max="10"
                            step="0.1"
                            style="width: 70px"
                    /></span>
                </div>

                <div class="d-flex justify-content-center align-items-center inputs" id="inputs">
                    <span
                        >Grid Size: <input type="number" class="dark-text" value="25" id="grid-size" min="4" max="25"
                    /></span>
                    |
                    <span
                        >Grid Line Thickness:
                        <input type="number" class="dark-text" value="10" id="grid-thickness" min="1"
                    /></span>
                    |
                    <label for="show-grid-lines">Show Grid Lines</label
                    ><input type="checkbox" id="show-grid-lines" checked />
                    |
                    <button style="background-color: #6ac4ff" type="submit" id="btn-process">Process</button>
                </div>

                <hr />
                <div id="item-selections-container">
                    <button type="submit" id="btn-toggle-images">Toggle Images</button>
                    Input Images:
                </div>

                <div id="image-inputs" class="image-inputs-container">
                    <div class="image-block">
                        <div class="image-label">Original Image:</div>
                        <img class="viewer-image" id="upload-preview" src="images/misc/empty.png" />
                    </div>
                    <div class="image-block">
                        <div class="image-label">Mapped Image (click to navigate Tile Preview):</div>
                        <div id="mapped-image-container">
                            <canvas id="output-canvas"></canvas>
                            <canvas id="overlay-canvas"></canvas>
                            <div id="hover-tooltip"></div>
                        </div>
                    </div>
                </div>

                <div
                    id="progress-overlay"
                    style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: rgba(0, 0, 0, 0.6);
                        color: white;
                        font-size: 24px;
                        display: none;
                        align-items: center;
                        justify-content: center;
                        z-index: 9999;
                    "
                >
                    <div id="progress-text">Loading image...</div>
                </div>

                <hr />
            </div>
            <!-- end right pane -->
        </div>
        <!-- end layout -->

        <!-- Footer -->
        <footer>
            <div class="container text-center">
                <div class="site-footer-links">
                    <a href="https://github.com/RnDMonkey/ck-web-tools"><i class="ri-open-source-fill"></i></a>
                    <a href="https://github.com/RnDMonkey/ck-web-tools"><i class="ri-at-fill"></i></a>
                    <a href="https://github.com/RnDMonkey/ck-web-tools"><i class="ri-github-fill"></i></a>
                </div>
            </div>
        </footer>

        <!-- Core JS Libraries - Bootstrap core JavaScript & Jquery  etc. -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"
        ></script>

        <!-- Custom scripts -->
        <script type="module" src="js/pixelmap.js"></script>

        <!-- Table Creation -->
        <script>
            const tableDims = 25;
            const previewTableParentDOM = document.getElementById("preview-table-container");
            const previewTableDOM = document.getElementById("preview-table");

            for (let y = 0; y < tableDims; y++) {
                const row = document.createElement("tr");
                row.id = `preview-row-${y}`;

                for (let x = 0; x < tableDims; x++) {
                    const cell = document.createElement("td");

                    const img = document.createElement("img");
                    img.id = `cell-${x}-${y}`;
                    img.className = "preview-cell";
                    img.style.backgroundColor = "transparent";
                    // img.width = Globals.ICON_DIMS
                    // img.height = Globals.ICON_DIMS
                    img.src = "images/misc/empty.png";
                    img.style.display = "block";

                    cell.appendChild(img);
                    row.appendChild(cell);
                }

                previewTableDOM.appendChild(row);
            }
        </script>

        <!-- Panel resizing -->
        <script>
            const leftPane = document.getElementById("left-pane");
            const middlePane = document.getElementById("middle-pane");
            const dragLeft = document.getElementById("drag-bar-left");
            const dragRight = document.getElementById("drag-bar-right");

            let draggingLeft = false;
            let draggingRight = false;

            dragLeft.addEventListener("mousedown", () => {
                draggingLeft = true;
                document.body.style.cursor = "ew-resize";
            });

            dragRight.addEventListener("mousedown", () => {
                draggingRight = true;
                document.body.style.cursor = "ew-resize";
            });

            window.addEventListener("mousemove", (e) => {
                if (draggingLeft) {
                    const newWidth = e.clientX;
                    // if (newWidth > 150 && newWidth < 1000) leftPane.style.flexBasis = newWidth + "px";
                    leftPane.style.flexBasis = newWidth + "px";
                }

                if (draggingRight) {
                    const layoutWidth = document.getElementById("layout").offsetWidth;
                    const leftWidth = leftPane.offsetWidth;
                    const newMiddleWidth = e.clientX - leftWidth;

                    if (newMiddleWidth > 400 && newMiddleWidth < 1200) {
                        middlePane.style.flexBasis = newMiddleWidth + "px";
                    }
                }
            });

            window.addEventListener("mouseup", () => {
                draggingLeft = false;
                draggingRight = false;
                document.body.style.cursor = "default";
            });
        </script>
    </body>
</html>
